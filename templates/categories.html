{% extends "base.html" %}

{% block content %}
<h1>‚ôªÔ∏è Kategorien & Umweltinfos</h1>

<style>
  .card {
    margin-bottom: 25px;
    padding: 20px;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  }

  .card h3 {
    margin-top: 0;
    margin-bottom: 10px;
  }

  .stars {
    font-size: 18px;
    display: inline-block;
    margin-left: 6px;
  }

  .material-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding-left: 0;
    list-style: none;
    margin: 10px 0 0 0;
  }

  .material-item {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 54px;
    height: 54px;
    border-radius: 50%;
    color: white;
    font-weight: bold;
    font-size: 11px;
    cursor: default;
    text-align: center;
    user-select: none;
  }

  /* Tooltip */
  .material-item span.tooltip {
    visibility: hidden;
    width: 170px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 8px;
    padding: 7px 8px;
    position: absolute;
    z-index: 10;
    bottom: 66px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
    line-height: 1.25;
    opacity: 0;
    transition: opacity 0.2s;
    pointer-events: none;
  }

  .material-item:hover span.tooltip {
    visibility: visible;
    opacity: 1;
  }

  .btn {
    display: inline-block;
    padding: 10px 15px;
    margin-top: 16px;
    background-color: #89CFF0;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: bold;
  }

  .btn:hover {
    background-color: #5bb0e3;
  }

  .btn-secondary {
    background-color: #e9eef2;
    color: #1a1a1a;
    margin-left: 10px;
  }

  .btn-secondary:hover {
    background-color: #dbe3ea;
  }

  .material-item[data-color="#1e90ff"] { background-color: #1e90ff; }
  .material-item[data-color="#f1c40f"] { background-color: #f1c40f; }
  .material-item[data-color="#27ae60"] { background-color: #27ae60; }
  .material-item[data-color="#8e6e53"] { background-color: #8e6e53; }
  .material-item[data-color="gray"] { background-color: gray; }
</style>

{% for name, data in categories.items() %}
  {% set score = (data.score | default(0) | int) %}
  {% if score < 0 %}{% set score = 0 %}{% endif %}
  {% if score > 5 %}{% set score = 5 %}{% endif %}

  <div class="card">
    <h3>{{ name }}</h3>

    <p>üåç {{ data.description | default('Keine Beschreibung verf√ºgbar') }}</p>

    <p>üí® <b>CO‚ÇÇ:</b> {{ data.co2 | default('Noch keine Daten vorhanden') }}</p>

    <p>‚≠ê <b>Punkte:</b> {{ data.points | default(0) }}</p>

    <p>üí° <b>Tipp:</b> {{ data.tip | default('Kein Tipp verf√ºgbar') }}</p>

    <!-- Umwelt-Ranking (nur Score/Zahl, kein "recycelbar") -->
    <p>
      üå± <b>Umwelt-Ranking:</b>
      <span class="stars" aria-label="Umwelt-Ranking {{ score }} von 5">
        {% for i in range(score) %}
          <span style="color: gold;">‚≠ê</span>
        {% endfor %}
        {% for i in range(5 - score) %}
          <span style="color: lightgray;">‚≠ê</span>
        {% endfor %}
      </span>
      <span style="margin-left: 6px;">({{ score }}/5)</span>
    </p>

    <!-- Web-Link pro Kategorie (falls vorhanden) -->
    {% if data.web_url is defined and data.web_url %}
      <p>
        üîó <a href="{{ data.web_url }}" target="_blank" rel="noopener noreferrer">Mehr Infos (Web)</a>
      </p>
    {% endif %}

    <!-- Materialien -->
    <h4>Materialien</h4>

    {% if data.materials is defined and data.materials | length > 0 %}
      <ul class="material-list">
        {% for material in data.materials %}
          {% set m_score = (material.score | default(material.points | default(0)) | int) %}
          {% if m_score < 0 %}{% set m_score = 0 %}{% endif %}
          {% if m_score > 5 %}{% set m_score = 5 %}{% endif %}

          <li class="material-item" data-color="{{ material.color | default('gray') }}">
            {{ (material.short | default(material.name | default('MAT')))[:3] | upper }}

            <span class="tooltip">
              <b>{{ material.name | default('Material') }}</b><br>
              Punkte: {{ material.points | default(m_score) }}<br>
              Ranking: {{ m_score }}/5
              {% if material.note is defined and material.note %}
                <br>{{ material.note }}
              {% endif %}
              {% if material.web_url is defined and material.web_url %}
                <br><span style="opacity:0.9;">Web: vorhanden</span>
              {% endif %}
            </span>
          </li>
        {% endfor %}
      </ul>

      <!-- Material-Weblinks optional als Liste darunter (klickbar) -->
      {% set any_material_links = false %}
      {% for material in data.materials %}
        {% if material.web_url is defined and material.web_url %}
          {% set any_material_links = true %}
        {% endif %}
      {% endfor %}

      {% if any_material_links %}
        <p style="margin-top: 12px;">
          üîó <b>Material-Links:</b><br>
          {% for material in data.materials %}
            {% if material.web_url is defined and material.web_url %}
              ‚Ä¢ <a href="{{ material.web_url }}" target="_blank" rel="noopener noreferrer">
                  {{ material.name | default('Material') }}
                </a><br>
            {% endif %}
          {% endfor %}
        </p>
      {% endif %}

    {% else %}
      <p>Keine Materialien verf√ºgbar</p>
    {% endif %}

  </div>
{% endfor %}

<!-- Navigation -->
<a href="{{ url_for('index') }}" class="btn">‚¨Ö Zur√ºck</a>

{% if 'pluspoint_page' in (globals() | default({})) %}
  <a href="{{ url_for('pluspoint_page') }}" class="btn btn-secondary">‚ûï Pluspunkte</a>
{% endif %}

{% endblock %}
